<!DOCTYPE html>
<html>
  <head>
    <title>ÈÖçÁ•û</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= favicon_link_tag 'favicon.png' %>

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <style>
      .header-btn {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        text-decoration: none;
        font-size: 13px;
        font-weight: bold;
        padding: 6px 14px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.2s;
      }

      .header-btn:hover {
        background-color: rgba(255, 255, 255, 0.25);
        transform: translateY(-1px);
      }

      .cute-nav {
        background-color: #1e293b;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 2rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .user-area-right {
        display: flex;
        align-items: center;
        position: relative;
      }

      .cute-avatar {
        width: 48px;
        height: 48px;
        aspect-ratio: 1 / 1;
        background-color: white;
        border-radius: 9999px;
        border: 2px solid white;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        margin-right: 12px;
        flex-shrink: 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      .cute-avatar img { width: 100%; height: 100%; object-fit: cover; }

      .cute-name {
        color: white;
        font-size: 20px;
        font-weight: bold;
        white-space: nowrap;
        margin-right: 4px;
      }

      „Éªmenu-toggle-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        display: flex;
        align-items: center;
        transition: transform 0.3s ease;
      }

      .arrow-white {
        width: 24px;
        height: 24px;
        fill: #ffffff !important;
      }

      .cute-dropdown {
        display: none;
        position: absolute;
        top: 130%;
        right: 0;
        background: white;
        min-width: 200px;
        border-radius: 12px;
        box-shadow: 0 15px 25px rgba(0,0,0,0.2);
        z-index: 9999;
        overflow: hidden;
        border: 1px solid #e2e8f0;
      }

      .is-open { display: block !important; }
      .rotate-180 { transform: rotate(180deg); }

      .dropdown-link {
        display: block;
        padding: 14px 20px;
        text-decoration: none;
        color: #334155;
        font-size: 15px;
        text-align: left;
      }
      .dropdown-link:hover  {
        background-color: #f1f5f9; }

    </style>
  </head>

  <body class="bg-gray-50 text-gray-900 antialiased">
    <nav class="cute-nav no-print mb-8">
      <div style="display: flex; align-items: center;">
        <div class="text-2xl font-black italic tracking-tighter text-white">
          <%= link_to "ÈÖçÁ•û", dashboards_show_path, class: "no-underline text-white" %>
        </div>

        <div style="margin-left: 24px; display: flex; gap: 8px;">
          <%= link_to "ÁèæÂ†¥Ë®≠ÂÆö", sites_path, class: "header-btn" %>
          <%= link_to "„É°„É≥„Éê„ÉºË®≠ÂÆö", members_path, class: "header-btn" %>
          <%= link_to "Ëªä‰∏°Ë®≠ÂÆö", vehicles_path, class: "header-btn" %>
        </div>
      </div>

      <div class="user-area-right">
        <% if logged_in? %>
          <div class="cute-avatar">
            <% if current_user.respond_to?(:avatar) && current_user.avatar.attached? %>
              <%= image_tag current_user.avatar, class: "w-full h-full object-cover" %>
            <% else %>
              <span style="color: #94a3b8; font-size: 24px;">üë§</span>
            <% end %>
          </div>

          <span class="cute-name"><%= current_user.name %></span>

          <button id="menu-toggle-btn">
            <svg id="arrow-icon" class="arrow-white" viewBox="0 0 20 20">
              <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
            </svg>
          </button>

          <div id="dropdown-menu" class="cute-dropdown">
            <div style="padding: 12px 20px; font-size: 11px; color: #64748b; font-weight: bold; border-bottom: 1px solid #f1f5f9; background: #f8fafc;">
              „Ç¢„Ç´„Ç¶„É≥„ÉàË®≠ÂÆö
            </div>

            <%# ‰øÆÊ≠£Ôºö„É≠„Ç∞„Ç§„É≥‰∏≠„ÅÆID„Åå "guest" „Åß„ÅØ„Å™„ÅÑÊôÇ„Å†„Åë„ÄÅÁ∑®ÈõÜ„É™„É≥„ÇØ„ÇíÂá∫„Åô %>
            <% if current_user.email != "guest" %>
              <%= link_to "üë§ „Éó„É≠„Éï„Ç£„Éº„É´„ÇíÁ∑®ÈõÜ", edit_user_path(current_user), class: "dropdown-link" %>
            <% else %>
              <div class="dropdown-link" style="color: #94a3b8; font-size: 13px; cursor: default;">
                üîí „Ç≤„Çπ„Éà„ÅØÁ∑®ÈõÜ„Åß„Åç„Åæ„Åõ„Çì
              </div>
            <% end %>

            <div style="border-top: 1px solid #f1f5f9;"></div>
            <%= link_to "üö™ „É≠„Ç∞„Ç¢„Ç¶„Éà", logout_path, data: { turbo_method: :delete }, class: "dropdown-link font-bold", style: "color: #ef4444;" %>
          </div>
        <% else %>
          <%= link_to "„É≠„Ç∞„Ç§„É≥", login_path, style: "color: white; text-decoration: none; font-weight: bold; border: 2px solid white; padding: 6px 18px; border-radius: 99px;" %>
        <% end %>
      </div>
    </nav>

    <main class="max-w-[1600px] mx-auto px-4 pb-20">
      <%= yield %>
    </main>

    <script>
      document.addEventListener('turbo:load', () => {
        const btn = document.getElementById('menu-toggle-btn');
        const menu = document.getElementById('dropdown-menu');
        const arrow = document.getElementById('arrow-icon');

        if (btn && menu) {
          btn.onclick = (e) => {
            e.stopPropagation();
            menu.classList.toggle('is-open');
            arrow.classList.toggle('rotate-180');
          };
          document.onclick = () => {
            menu.classList.remove('is-open');
            arrow.classList.remove('rotate-180');
          };
        }
      });
    </script>
  </body>
</html>
